<!doctype html>
<html lang="en">
    <head>
        <title></title>        
        <style>
            body{ margin: 0; padding: 0; overflow: hidden; }
            canvas{ background-color: cornflowerblue; }
			textarea{ background-color: black;}
        </style>
    </head>
    <body>

        <canvas id="my-canvas"></canvas>

        <script type="text/javascript" src="js/lib/gl-matrix.js"></script>

        <script type="text/javascript" src="js/lib/dat.gui.min.js"></script>

        <script id="shader-fs" type="x-shader/x-fragment">

            precision highp float;

            uniform vec3 uColor;

            varying vec3 vNormal;
            varying vec3 vPosWorld;

            vec3 lightVec;
            vec3 diffColor;
            vec3 color;

            varying highp vec2 vUv;

            vec2 uvScaled;

            uniform float uScale;
            uniform float vScale;
            uniform sampler2D uSampler;

            uniform vec3 uViewerPosition;
            uniform float uGlossiness;
            uniform float uKsFactor;

            vec3 directPhong(vec3 lightVec, vec4 textureColor) {

                // Iluminacion ambiental de Phong
                vec3 ka = textureColor.xyz;
                vec3 ia = vec3(1.0,0.71,0.0);
                vec3 ambientIllumination = ka * ia * 0.1;

                // Iluminacion difusa de Phong
                vec3 kd = ka;
                vec3 id = vec3(1.0,1.0,1.0);
                vec3 diffuseIllumination = clamp(dot(lightVec, vNormal), 0.0, 1.0)*kd*id;

                // Iluminacion especular de Phong
                vec3 ks = vec3(1.0,1.0,1.0);
                vec3 is = vec3(1.0,1.0,1.0);
                vec3 viewerVector = normalize(-uViewerPosition);
                vec3 reflectionVector = normalize(2.0*vNormal*dot(lightVec, vNormal) - lightVec);
                float RdotV = clamp(dot(reflectionVector, viewerVector), 0.0, 1.0);
                vec3 specularIllumination = pow(RdotV, uGlossiness)*ks*is*uKsFactor;

                vec3 phongIllumination = ambientIllumination + diffuseIllumination + specularIllumination;
                return phongIllumination;
            }

            void main(void) {

                lightVec=normalize(vec3(0.0,3.0,5.0)-vPosWorld);
	            diffColor=uColor;
	            color=dot(lightVec,vNormal)*diffColor+vec3(0.2,0.2,0.2);
	            color= mix(uColor, color, 0.3);

                uvScaled.x = vUv.x * uScale;
                uvScaled.y = vUv.y * vScale;

                vec4 textureColor = texture2D(uSampler,uvScaled);
                vec3 sunDirection = normalize( vec3(1.0,1.0,1.0) );

                vec3 BRIGHTNESS = directPhong(sunDirection,textureColor);

                gl_FragColor = vec4(BRIGHTNESS.xyz,1.0);
            }
        </script>
        
        <script type="module" src="js/main.js"></script>

    </body>
</html>
